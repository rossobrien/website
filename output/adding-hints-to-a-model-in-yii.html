<!DOCTYPE html>
<html lang="en">
<head>
		<title>Ross O'Brien &mdash; Adding Hints to a Model in Yii</title>
		<meta charset="utf-8" />
		<link rel="profile" href="http://gmpg.org/xfn/11" />

		<style type='text/css'>@font-face {
			font-family: 'LeagueGothic';
			src: url('./theme/css/fonts/leaguegothic-regular-webfont.eot'); /* IE9 Compat Modes */
			src: url('./theme/css/fonts/leaguegothic-regular-webfont.eot?iefix') format('eot'), /* IE6-IE8 */
			     url('./theme/css/fonts/leaguegothic-regular-webfont.woff') format('woff'), /* Modern Browsers */
			     url('./theme/css/fonts/leaguegothic-regular-webfont.ttf')  format('truetype'), /* Safari, Android, iOS */
			     url('./theme/css/fonts/leaguegothic-regular-webfont.svg#webfont3nLbXkSC') format('svg'); /* Legacy iOS */
		}</style>

		<link rel='stylesheet' id='framework-css' href='./theme/css/framework.css' type='text/css' media='screen'/>
		<link rel="stylesheet" id="style-css" type="text/css" href="./theme/css/style.css" />

		<link rel="alternate" type="application/atom+xml"
			title="Ross O'Brien — Flux Atom"
			href="./" /> 
		<!--[if lte IE 8]><script src="./theme/js/html5shiv.js"></script><![endif]-->
</head>

<body class="home blog content-wide sidebar content-wide-sidebar " >
	<div id="wrapper">
		<header id="header">
				<h1 id="site-name"><a href="." title="Ross O'Brien">Ross O'Brien</a></h1>
<div id="header-message">Web Developer - Seattle, WA</div>		</header><!-- /#banner -->
		
		
		<div class="page-title">
		</div>
	
		<div id="contents">

<div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="main">
		<header>
			<time datetime="2012-10-30 13:00:00">October 30, 2012</time>
			<h1>
				<a href="./adding-hints-to-a-model-in-yii.html" title="Permalink to Adding Hints to a Model in Yii" rel="bookmark">Adding Hints to a Model in Yii</a>
			</h1>
		</header>
		<div class="entry-content">
			<p>Like most programmers, I spend a fair amount of time browsing
<a href="http://stackoverflow.com">StackOverflow</a>. A few weeks ago, I saw this
question on there.</p>
<blockquote>
<p>I need to have comments/hints for some fields in my Form. My idea is
to describe it in model, just like attributeLabels. How can I do it?</p>
<p>And then it would be ideal, if the Gii Model (and Crud) generator
would take it directly from mysql column's comment</p>
</blockquote>
<p>Thanks to my time spent with Yii while working
on <a href="http://getpear.com">Pear</a> for <a href="http://apparelmedia.com">Apparel
Media</a>, I was able to contribute an answer. I
think is a pretty good tutorial for adding any attribute to a model, so
I'll go over it here as well.</p>
<p>First off, <a href="http://stackoverflow.com/questions/12319659/yii-model-attributes-comments-hints">here's the
post</a>
on StackOverflow. The question can be broken down into two parts:</p>
<ol>
<li>Describe hints in the model and display on the form.</li>
<li>Get hints from mysql comment</li>
</ol>
<p><strong>Displaying Hints from Model</strong></p>
<p>Here's a slightly modified version of the default <code>login.php</code> file
generated by <code>Yiic</code></p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;?php $form=$this-&gt;beginWidget(&#39;CActiveForm&#39;, array(</span>
<span class="cp">        &#39;id&#39;                     =&gt; &#39;login-form&#39;,</span>
<span class="cp">        &#39;enableClientValidation&#39; =&gt; true,</span>
<span class="cp">        &#39;clientOptions&#39;          =&gt; array(</span>
<span class="cp">            &#39;validateOnSubmit&#39; =&gt; true,</span>
<span class="cp">        ),</span>
<span class="cp">    )); ?&gt;</span>

        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;note&quot;</span><span class="nt">&gt;</span>Fields with <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;required&quot;</span><span class="nt">&gt;</span>*<span class="nt">&lt;/span&gt;</span> are required.<span class="nt">&lt;/p&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
            <span class="cp">&lt;?php echo $form-&gt;labelEx($model,&#39;username&#39;); ?&gt;</span>
            <span class="cp">&lt;?php echo $form-&gt;textField($model,&#39;username&#39;); ?&gt;</span>
            <span class="cp">&lt;?php echo $form-&gt;error($model,&#39;username&#39;); ?&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
            <span class="cp">&lt;?php echo $form-&gt;labelEx($model,&#39;password&#39;); ?&gt;</span>
            <span class="cp">&lt;?php echo $form-&gt;passwordField($model,&#39;password&#39;); ?&gt;</span>
            <span class="cp">&lt;?php echo $form-&gt;error($model,&#39;password&#39;); ?&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;hint&quot;</span><span class="nt">&gt;</span>
                Hint: You may login with <span class="nt">&lt;kbd&gt;</span>demo<span class="nt">&lt;/kbd&gt;</span>/<span class="nt">&lt;kbd&gt;</span>demo<span class="nt">&lt;/kbd&gt;</span> or <span class="nt">&lt;kbd&gt;</span>admin<span class="nt">&lt;/kbd&gt;</span>/<span class="nt">&lt;kbd&gt;</span>admin<span class="nt">&lt;/kbd&gt;</span>.
            <span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row rememberMe&quot;</span><span class="nt">&gt;</span>
            <span class="cp">&lt;?php echo $form-&gt;checkBox($model,&#39;rememberMe&#39;); ?&gt;</span>
            <span class="cp">&lt;?php echo $form-&gt;label($model,&#39;rememberMe&#39;); ?&gt;</span>
            <span class="cp">&lt;?php echo $form-&gt;error($model,&#39;rememberMe&#39;); ?&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row buttons&quot;</span><span class="nt">&gt;</span>
            <span class="cp">&lt;?php echo CHtml::submitButton(&#39;Login&#39;); ?&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

    <span class="cp">&lt;?php $this-&gt;endWidget(); ?&gt;</span>
<span class="nt">&lt;/div&gt;</span><span class="c">&lt;!-- form --&gt;</span>
</pre></div>


<p>Let's move that password hint into the model by adding
a <code>attributeHints()</code> method and a <code>getHint()</code> method to
the <code>LoginForm.php</code> model.</p>
<div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Declares attribute hints.</span>
<span class="cm"> */</span>
<span class="k">public</span> <span class="nf">function</span> <span class="nx">attributeHints</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="kt">array</span><span class="p">(</span>
            <span class="s1">&#39;password&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;Hint: You may login with &lt;kbd&gt;demo&lt;/kbd&gt;/&lt;kbd&gt;demo&lt;/kbd&gt; or &lt;kbd&gt;admin&lt;/kbd&gt;/&lt;kbd&gt;admin&lt;/kbd&gt;.&#39;</span><span class="p">,</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Return a hint</span>
<span class="cm"> */</span>
<span class="k">public</span> <span class="nf">function</span> <span class="nx">getHint</span><span class="p">(</span> <span class="nv">$attribute</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$hints</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nx">attributeHints</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$hints</span><span class="err">[</span><span class="nv">$attribute</span><span class="cp">]</span>;
}
</pre></div>


<p>As you can see, we've moved the hint text from the view into the model
and added a way to access it.</p>
<p>Now, back in <code>login.php</code>, let's add the hint tag based on data from the
model.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;?php echo $form-&gt;labelEx($model,&#39;password&#39;); ?&gt;</span>
    <span class="cp">&lt;?php echo $form-&gt;passwordField($model,&#39;password&#39;); ?&gt;</span>
    <span class="cp">&lt;?php echo $form-&gt;error($model,&#39;password&#39;); ?&gt;</span>
    <span class="cp">&lt;?php echo CHtml::tag(&#39;p&#39;, array(&#39;class&#39;=&gt;&#39;hint&#39;), $model-&gt;getHint(&#39;password&#39;)); ?&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p>So now we've changed the hardcoded hint into a yii-generated element
populated with data from the model. This is a pretty good start, but
hardcoding stuff isn't quite ideal, so let's move on to the second part
of the question.</p>
<p><strong>Getting hints from mySQL comments</strong></p>
<p>Unfortunately, I don't think it is possible for Yii/Gii to automatically
generate the hints from mySQL comments. However, we can just pull the
mySQL comments (or other mySQL data) into the model ourselves.</p>
<p>To do this we can use the following mySQL query</p>
<div class="highlight"><pre><span class="n">SHOW</span> <span class="n">FULL</span> <span class="n">COLUMNS</span> <span class="n">FROM</span> <span class="err">`</span><span class="n">tbl_user</span><span class="err">`</span>
</pre></div>


<p>So let's add the comment to the password field</p>
<div class="highlight"><pre><span class="nx">ALTER</span> <span class="nb">TABLE</span>  <span class="sb">`tbl_user`</span> 
<span class="nx">CHANGE</span>  <span class="sb">`password`</span>  <span class="sb">`password`</span> <span class="nx">VARCHAR</span><span class="p">(</span> <span class="mi">256</span> <span class="p">)</span> 
<span class="nx">CHARACTER</span> <span class="nb">SET</span> <span class="nx">latin1</span> <span class="nx">COLLATE</span> <span class="nx">latin1_swedish_ci</span> <span class="kt">NULL</span> <span class="nb">DEFAULT</span> <span class="kt">NULL</span> 
<span class="nx">COMMENT</span>  <span class="s1">&#39;Hint: You may login with &lt;kbd&gt;demo&lt;/kbd&gt;/&lt;kbd&gt;demo&lt;/kbd&gt; or &lt;kbd&gt;admin&lt;/kbd&gt;/&lt;kbd&gt;admin&lt;/kbd&gt;.&#39;</span><span class="p">;</span>
</pre></div>


<p>And let's add the code to fetch it into our <code>attributeHints()</code> method.</p>
<div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Declares attribute hints.</span>
<span class="cm"> */</span>
<span class="n">public</span> <span class="k">function</span> <span class="n">attributeHints</span><span class="p">()</span>
<span class="p">{</span>
    <span class="err">$</span><span class="n">columns</span><span class="o">=</span> <span class="n">Yii</span><span class="o">::</span><span class="n">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">createCommand</span><span class="p">(&#39;</span><span class="no">SHOW</span> <span class="no">FULL</span> <span class="no">COLUMNS</span> <span class="no">FROM</span> <span class="no">`tbl_user</span><span class="err">`</span><span class="p">&#39;)</span><span class="o">-&gt;</span><span class="n">queryAll</span><span class="p">();</span>

    <span class="err">$</span><span class="n">comments</span><span class="o">=</span><span class="n">array</span><span class="p">();</span>
    <span class="k">foreach</span><span class="p">(</span><span class="err">$</span><span class="n">columns</span> <span class="n">as</span> <span class="err">$</span><span class="n">column</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">isset</span><span class="p">(</span> <span class="err">$</span><span class="n">column</span><span class="p">[&#39;</span><span class="n">Comment</span><span class="p">&#39;]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="err">$</span><span class="n">comments</span><span class="p">[</span> <span class="err">$</span><span class="n">column</span><span class="p">[&#39;</span><span class="n">Field</span><span class="p">&#39;]</span> <span class="p">]</span> <span class="o">=</span> <span class="err">$</span><span class="n">column</span><span class="p">[&#39;</span><span class="n">Comment</span><span class="p">&#39;];</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="c1">//Add any hardcoded hints here</span>
    <span class="err">$</span><span class="n">hints</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span>
            <span class="p">&#39;</span><span class="n">username</span><span class="p">&#39;</span><span class="o">=&gt;</span><span class="p">&#39;</span><span class="n">Enter</span> <span class="n">username</span> <span class="n">above</span><span class="p">&#39;,</span>
    <span class="p">);</span>

    <span class="c1">//Return merged array</span>
    <span class="k">return</span> <span class="n">array_merge</span><span class="p">(</span> <span class="err">$</span><span class="n">comments</span><span class="p">,</span> <span class="err">$</span><span class="n">hints</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>We now have two ways to set comments, through mySQL comments or through
hard coded statements.</p>
<p>Let's update our <code>login.php</code> file quick to get both of our hints.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;?php echo $form-&gt;labelEx($model,&#39;username&#39;); ?&gt;</span>
    <span class="cp">&lt;?php echo $form-&gt;textField($model,&#39;username&#39;); ?&gt;</span>
    <span class="cp">&lt;?php echo $form-&gt;error($model,&#39;username&#39;); ?&gt;</span>
    <span class="cp">&lt;?php echo CHtml::tag(&#39;p&#39;, array(&#39;class&#39;=&gt;&#39;hint&#39;), $model-&gt;getHint(&#39;username&#39;)); ?&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
    <span class="cp">&lt;?php echo $form-&gt;labelEx($model,&#39;password&#39;); ?&gt;</span>
    <span class="cp">&lt;?php echo $form-&gt;passwordField($model,&#39;password&#39;); ?&gt;</span>
    <span class="cp">&lt;?php echo $form-&gt;error($model,&#39;password&#39;); ?&gt;</span>
    <span class="cp">&lt;?php echo CHtml::tag(&#39;p&#39;, array(&#39;class&#39;=&gt;&#39;hint&#39;), $model-&gt;getHint(&#39;password&#39;)); ?&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p>And that's it!</p>
<p><img alt="Yii login page" src="http://blog.obrienross.com/wp-content/uploads/2012/10/login.png" /></p>
<p>Yii login page with hints pulled from the model[/caption]</p>
<p>Now our login page will look like this, with a username hint hardcoded
into the model and a password hint from the mySQL comment.</p>
<hr />
<p>That was the extent of my original answer, but this basic process can be
adapted to pretty much any type of attribute you'd want to pull from the
model. Here's another example, a function to generate a list of options
for a status dropdown, and a function to get the text of the model's
status.</p>
<div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @return array status options indexed by type IDs</span>
<span class="cm"> */</span>
<span class="n">public</span> <span class="k">function</span> <span class="n">getStatusOptions</span><span class="p">()</span>
<span class="p">{</span>
    <span class="err">$</span><span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;SELECT id, name FROM `status_options`&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="err">$</span><span class="n">options</span> <span class="o">=</span> <span class="n">Yii</span><span class="o">::</span><span class="n">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">createCommand</span><span class="p">(</span><span class="err">$</span><span class="n">sql</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">queryAll</span><span class="p">();</span>

    <span class="err">$</span><span class="n">statusOptions</span> <span class="o">=</span> <span class="n">array</span><span class="p">();</span>
    <span class="k">foreach</span><span class="p">(</span><span class="err">$</span><span class="n">options</span> <span class="n">as</span> <span class="err">$</span><span class="n">option</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="err">$</span><span class="n">statusOptions</span><span class="p">[</span> <span class="err">$</span><span class="n">option</span><span class="p">[&#39;</span><span class="n">id</span><span class="p">&#39;]</span> <span class="p">]</span> <span class="o">=</span> <span class="err">$</span><span class="n">option</span><span class="p">[&#39;</span><span class="n">name</span><span class="p">&#39;];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="err">$</span><span class="n">statusOptions</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @return string The text for status options</span>
<span class="cm">*/</span>
<span class="n">public</span> <span class="k">function</span> <span class="n">getStatusText</span><span class="p">()</span>
<span class="p">{</span>
    <span class="err">$</span><span class="n">statusOptions</span> <span class="o">=</span> <span class="err">$</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getStatusOptions</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">isset</span><span class="p">(</span><span class="err">$</span><span class="n">statusOptions</span><span class="p">[</span><span class="err">$</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">status_id</span><span class="p">])</span> <span class="o">?</span> <span class="err">$</span><span class="n">statusOptions</span><span class="p">[</span><span class="err">$</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">status_id</span><span class="p">]</span> <span class="o">:</span> <span class="s">&quot;Unknown Status! ({$this-&gt;status_id})&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>When developing in Yii (or any MVC framework), I find having simple functions to get data from
the model is extremely useful. Hopefully you do too!</p>
		</div> <!--/#entry-content-->
		<footer>
				<span class="byline">Written by <a href="./author/ross.html">ross</a></span>
					<span class="cat-links"> ― Posted in <a href="./category/tech.html" title="View all posts in Tech" rel="category tag">Tech</a></span>
	    		<span class="tag-links"> ― Tags
 <a href="./tag/php.html" rel="tag">php</a>,  <a href="./tag/stackoverflow.html" rel="tag">stackoverflow</a>,  <a href="./tag/tutorial.html" rel="tag">tutorial</a>,  <a href="./tag/yii.html" rel="tag">yii</a>	    		</span>
	    </footer>
	</div> <!--/#main-->
</div>  <!--/#post-->

		</div>
		
		<div id="footer">
			<div id="footer-message">
 <a href="http://twitter.com/obrienross">twitter</a>
 -  <a href="http://github.com/rossobrien">github</a>
			</div>
		</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>