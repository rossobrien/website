Title: Adding Hints to a Model in Yii
date:   2012-10-30 13:00
author:   ross
category:   Tech
tags:   php, stackoverflow, tutorial, yii
slug:   adding-hints-to-a-model-in-yii

Like most programmers, I spend a fair amount of time browsing
[StackOverflow](http://stackoverflow.com). A few weeks ago, I saw this
question on there.

> I need to have comments/hints for some fields in my Form. My idea is
> to describe it in model, just like attributeLabels. How can I do it?
>
> And then it would be ideal, if the Gii Model (and Crud) generator
> would take it directly from mysql column's comment

Thanks to my time spent with Yii while working
on [Pear](http://getpear.com) for [Apparel
Media](http://apparelmedia.com), I was able to contribute an answer. I
think is a pretty good tutorial for adding any attribute to a model, so
I'll go over it here as well.

First off, [here's the
post](http://stackoverflow.com/questions/12319659/yii-model-attributes-comments-hints)
on StackOverflow. The question can be broken down into two parts:

1.  Describe hints in the model and display on the form.
2.  Get hints from mysql comment

**Displaying Hints from Model**

Here's a slightly modified version of the default `login.php` file
generated by `Yiic`

	:::html+php
	<div class="form">
		<?php $form=$this->beginWidget('CActiveForm', array(
			'id'                     => 'login-form',
			'enableClientValidation' => true,
			'clientOptions'          => array(
				'validateOnSubmit' => true,
				),
				)); ?>

				<p class="note">Fields with <span class="required">*</span> are required.</p>

				<div class="row">
				<?php echo $form->labelEx($model,'username'); ?>
				<?php echo $form->textField($model,'username'); ?>
				<?php echo $form->error($model,'username'); ?>
			</div>

			<div class="row">
			<?php echo $form->labelEx($model,'password'); ?>
			<?php echo $form->passwordField($model,'password'); ?>
			<?php echo $form->error($model,'password'); ?>
			<p class="hint">
			Hint: You may login with <kbd>demo</kbd>/<kbd>demo</kbd> or <kbd>admin</kbd>/<kbd>admin</kbd>.
		</p>
	</div>

	<div class="row rememberMe">
		<?php echo $form->checkBox($model,'rememberMe'); ?>
		<?php echo $form->label($model,'rememberMe'); ?>
		<?php echo $form->error($model,'rememberMe'); ?>
	</div>

	<div class="row buttons">
		<?php echo CHtml::submitButton('Login'); ?>
	</div>

	<?php $this->endWidget(); ?>
	</div><!-- form -->

Let's move that password hint into the model by adding
a `attributeHints()` method and a `getHint()` method to
the `LoginForm.php` model.

	:::php
	<?php
	/**
	 * Declares attribute hints.
	 */
	public function attributeHints()
	{
		return array(
			'password'=>'Hint: You may login with <kbd>demo</kbd>/<kbd>demo</kbd> or <kbd>admin</kbd>/<kbd>admin</kbd>.',
		);
	}

	/**
	* Return a hint
	*/
	public function getHint( $attribute )
	{
		$hints = $this->attributeHints();
		return $hints[$attribute];
	}
	?>

As you can see, we've moved the hint text from the view into the model
and added a way to access it.

Now, back in `login.php`, let's add the hint tag based on data from the
model.

	:::html+php
	<div class="row">
	    <?php echo $form->labelEx($model,'password'); ?>
	    <?php echo $form->passwordField($model,'password'); ?>
	    <?php echo $form->error($model,'password'); ?>
	    <?php echo CHtml::tag('p', array('class'=>'hint'), $model->getHint('password')); ?>
	</div>

So now we've changed the hardcoded hint into a yii-generated element
populated with data from the model. This is a pretty good start, but
hardcoding stuff isn't quite ideal, so let's move on to the second part
of the question.

**Getting hints from mySQL comments**

Unfortunately, I don't think it is possible for Yii/Gii to automatically
generate the hints from mySQL comments. However, we can just pull the
mySQL comments (or other mySQL data) into the model ourselves.

To do this we can use the following mySQL query

	:::mysql
	SHOW FULL COLUMNS FROM `tbl_user`

So let's add the comment to the password field

	:::mysql
	ALTER TABLE  `tbl_user` 
	CHANGE  `password`  `password` VARCHAR( 256 ) 
	CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL 
	COMMENT  'Hint: You may login with <kbd>demo</kbd>/<kbd>demo</kbd> or <kbd>admin</kbd>/<kbd>admin</kbd>.';

And let's add the code to fetch it into our `attributeHints()` method.

	:::php
	<?php
	/**
	 * Declares attribute hints.
	 */
	public function attributeHints()
	{
		$columns= Yii::app()->db->createCommand('SHOW FULL COLUMNS FROM `tbl_user`')->queryAll();

		$comments=array();
		foreach($columns as $column) 
		{
			if( isset( $column['Comment'] ) )
			{
				$comments[ $column['Field'] ] = $column['Comment'];
			}

		}

		//Add any hardcoded hints here
		$hints = array(
			'username'=>'Enter username above',
		);

		//Return merged array
		return array_merge( $comments, $hints );
	}
	?>

We now have two ways to set comments, through mySQL comments or through
hard coded statements.

Let's update our `login.php` file quick to get both of our hints.

	:::html+php
	<div class="row">
	    <?php echo $form->labelEx($model,'username'); ?>
	    <?php echo $form->textField($model,'username'); ?>
	    <?php echo $form->error($model,'username'); ?>
	    <?php echo CHtml::tag('p', array('class'=>'hint'), $model->getHint('username')); ?>
	</div>

	<div class="row">
	    <?php echo $form->labelEx($model,'password'); ?>
	    <?php echo $form->passwordField($model,'password'); ?>
	    <?php echo $form->error($model,'password'); ?>
	    <?php echo CHtml::tag('p', array('class'=>'hint'), $model->getHint('password')); ?>
	</div>

And that's it!

![Yii login page](http://blog.obrienross.com/wp-content/uploads/2012/10/login.png)

*Yii login page with hints pulled from the model*

Now our login page will look like this, with a username hint hardcoded
into the model and a password hint from the mySQL comment.

* * * * *

That was the extent of my original answer, but this basic process can be
adapted to pretty much any type of attribute you'd want to pull from the
model. Here's another example, a function to generate a list of options
for a status dropdown, and a function to get the text of the model's
status.

	:::php
	<?php
	/**
	 * @return array status options indexed by type IDs
	 */
	public function getStatusOptions()
	{
		$sql = "SELECT id, name FROM `status_options`";
		}
		$options = Yii::app()->db->createCommand($sql)->queryAll();

		$statusOptions = array();
		foreach($options as $option)
		{
			$statusOptions[ $option['id'] ] = $option['name'];
		}

		return $statusOptions;
	}

	/*
	 * @return string The text for status options
	 */
	public function getStatusText()
	{
		$options = $this->getStatusOptions();
		return isset($options[$this->status_id]) ? $options[$this->status_id] : "Unknown Status! ({$this->status_id})";
	}
	?>

When developing in Yii (or any MVC framework), I find having simple functions to get data from
the model is extremely useful. Hopefully you do too!
